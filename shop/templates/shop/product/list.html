{% extends 'shop/base.html' %}
{% load static %}

{% block title %}
    {% if category %}{{ category.name }}{% else %}Товары{% endif %}
{% endblock %}

{% block content %}
    <div id="sidebar-custom" style="z-index: 2;">
        <h3 style="color: #111111;">Каталог</h3>
        <ul>
            <li {% if not category %}class="selected"{% endif %}>
                <a href="{% url 'shop:product_list' %}">Все</a>
            </li>
            {% for c in categories %}
                <li {% if category.slug == c.slug %}class="selected"{% endif %}>
                    <a href="{{ c.get_absolute_url }}">{{ c.name }}</a>
                </li>
            {% endfor %}
        </ul>
        <div class="wrapper">
            <header>
                <h2>Цена</h2>
            </header>
            <div class="price-input">
                <div class="field">
                    <span>от</span>
                    <input type="number" class="input-min" value="2500">
                </div>
                <div class="separator">-</div>
                <div class="field">
                    <span>до</span>
                    <input type="number" class="input-max" value="300000">
                </div>
            </div>
        </div>
    </div>
    <div id="main" class="product-list" style="">
        <h1 style="margin-bottom: 10%; width: 100%;">{% if category %}{{ category.name }}{% else %}Товары{% endif %}</h1>
        <div id="product-container">
            {% for product in filter %}
                <div class="item" style="padding-bottom: 0; position: relative;">
                    <a href="{{ product.get_absolute_url }}">
                        <img style="" src="{% if product.image %}{{ product.image.url }}{% else %}{% static 'img/no_image.png' %}{% endif %}">
                    </a>
                    <div style="margin-bottom: 1%; bottom: 30%; right: 25%; position: absolute;">
                        <a class="wrapper-break" style="padding-right: 0; text-align: right;" href="{{ product.get_absolute_url }}">
                            {{ product.name }}
                        </a>
                        <br>
                        <p style="text-align: right;">{{ product.price }} ₽</p>
                    </div>
                </div>
            {% endfor %}
        </div>
    </div>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        // Функция для обновления списка товаров
        function updateProductList(minPrice, maxPrice) {
            $.ajax({
                url: '{% url "shop:product_list" %}',
                type: 'GET',
                data: {
                    min_price: minPrice,
                    max_price: maxPrice
                },
                success: function(data) {
                    $('#product-container').html(data); // Обновляем содержимое контейнера товаров
                },
                error: function(xhr, errmsg, err) {
                    console.log(xhr.status + ": " + xhr.responseText);
                }
            });
        }

        // При изменении значений фильтра
        $('.price-input input').on('input', function() {
            var minPrice = $('.input-min').val();
            var maxPrice = $('.input-max').val();
            updateProductList(minPrice, maxPrice); // Обновляем список товаров с учетом новых значений фильтра
        });
    </script>
{% endblock %}
